# This file is sourced by tmux-open.sh
# Its purpose is to separate all session functions from the session opener script.

_tmux_session_python() {
	V_SESSION=$1
	V_WORKING_DIR=$2

	tmux new-session -d -s $V_SESSION "cd $V_WORKING_DIR; bash -i"
	tmux send-keys -t $V_SESSION 'clear; python' Enter
	tmux split-window -t $V_SESSION -v -p 80 "cd $V_WORKING_DIR; git st ; bash -i"
	tmux split-window -t $V_SESSION:0.0 -h "cd $V_WORKING_DIR; bash -i"
	tmux send-keys -t $V_SESSION "clear; $G_DROPBOX_DIR/src/bash-utils/pyguard.sh" Enter
	tmux select-pane -t $V_SESSION:0.1
}

_tmux_session_rails() {
	if [ -z "$(type -p rails)" ] ; then
		echo 'Rails is not installed, aborting...'
		exit
	fi

	V_SESSION=$1
	V_WORKING_DIR=$2

	tmux new-session -d -s $1 "cd $V_WORKING_DIR; bash -i"
	tmux send-keys -t $1 'clear; rails console' Enter
	tmux split-window -t $1:0.0 -v -p 80 "cd $V_WORKING_DIR; git st; bash -i"
	tmux split-window -t $1:0.0 -h -p 50 "cd $V_WORKING_DIR; bash -i"
	tmux send-keys -t $1 'clear; rails server' Enter
	tmux split-window -t $1 -h "cd $V_WORKING_DIR; bash -i"
	tmux send-keys -t $1 'clear; bundle exec guard' Enter
	tmux select-pane -t $1:0.1
}

tmux_session_gestao() {
	_tmux_session_rails $1 "$G_DROPBOX_DIR/src/ruby/gestao-escolas/"
}

tmux_session_git() {
	tmux new-session -d -s $1 'cd ~/src/local/dev_bin/ ; git bs ; bash -i'
	tmux split-window -t $1 -h 'cd ~/src/local/dev_htdocs/ ; git bs ; bash -i'
}

tmux_session_mysql() {
	tmux new-session -d -s $1 'mysql -h 10.20.26.29 -u developers -pgAt01at390 -D dev_xavier'
	tmux send-keys -t $1:0.0 'C-l'
	tmux split-window -t $1 -v 'mysql -h 10.20.26.29 -u developers -pgAt01at390 -D test_xavier'
	tmux send-keys -t $1:0.1 'C-l'
	tmux select-pane -t $1:0.0
}

tmux_session_vm206() {
	tmux new-session -d -s $1 'ssh vm206'
	tmux setw utf8 off
	tmux split-window -t $1 -h -p 20 'ssh vm206'
	tmux send-keys -t $1 'C-l' 'clear; devqa-error-log.sh -n 19' Enter
	tmux split-window -t $1 -v 'ssh vm206'
	tmux send-keys -t $1 'C-l' "clear; echo 'Log de erros em test:'; tail -F /var/log/httpd/test_php.log | grep -i xavier" Enter
	tmux select-pane -t $1:0.0
}

tmux_session_bash() {
	tmux new-session -d -s $1 "cd $G_DROPBOX_DIR/src/bash-utils ; git st ; bash -i"
}

tmux_session_seek() {
	_tmux_session_python $1 "$G_DROPBOX_DIR/src/python/seekandemploy/"
}

tmux_session_tag() {
	_tmux_session_python $1 "$G_DROPBOX_DIR/src/python/evrytag/"
}
